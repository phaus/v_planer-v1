<h1>Kunde <%= @client.client_no %></h1>

<%= last_changed_info @client %>

<div class="widget_container left">
  <div class="widget" id="user_info">
    <h2>Kundendetails</h2>
    <p>
      <b>Kundennummer:</b>
      <%=h @client.client_no %>
    </p>

    <% unless @client.company.blank? %>
      <p>
        <b>Firma:</b>
        <%=h @client.company_name %>
      </p>
    <% end %>

    <p>
      <b>Name:</b>
      <%=h @client.full_name %>
    </p>

    <% if @client.address %>
      <p>
        <b>Adresse:</b><br />
        <%= @client.address.to_html rescue 'nicht angegeben' %>
      </p>

      <p>
        <b>Telefon:</b>
        <%=h @client.address.phone %>
      </p>

      <p>
        <b>Fax:</b>
        <%=h @client.address.fax %>
      </p>

      <p>
        <b>Mobil:</b>
        <%=h @client.address.mobile %>
      </p>
    <% end %>

    <p>
      <b>E-Mail:</b>
      <%= mail_to @client.email %>
    </p>

    <p>
      <b>Ansprechpartner:</b>
      <%=h @client.contact_person.full_name %>
    </p>

    <p>
      <b>Zahlungsziel:</b>
      <%=h @client.payment_goal %> Tage
    </p>

    <p>
      <b>Kundenrabatt:</b>
      <%=h @client.discount %>%
    </p>
  </div>

  <% if @client.bank_account %>
    <div class="widget" id="user_info">
      <h2>Kontodaten</h2>
      <p>
        <b>Konto-Inhaber.:</b>
        <%=h @client.bank_account.registrar_name %>
      </p>
      <p>
        <b>Konto-Nr.:</b>
        <%=h @client.bank_account.number %>
      </p>
      <p>
        <b>BLZ:</b>
        <%=h @client.bank_account.blz %>
      </p>
      <p>
        <b>Bank:</b>
        <%=h @client.bank_account.bank_name %>
      </p>
      <p>
        <b>IBAN.:</b>
        <%=h @client.bank_account.iban %>
      </p>
      <p>
        <b>BIC.:</b>
        <%=h @client.bank_account.bic %>
      </p>
    </div>
  <% end %>
</div>

<div class="widget_container right">
  <div class="widget">
    <div class="full_width_input">
      <% form_for @client do |f| %>
        <h2><%= f.label :remarks, 'Anmerkungen' %></h2>
        <%= f.text_area :remarks, :size => '50x10', :class => 'initial' %>
      <% end %>
    </div>
  </div>
  <div class="widget">
    <% if @client.processes.any? %>
      <h2>Vorgänge</h2>

      <table class="data" style="width: 100%">
        <thead>
          <tr>
            <th>VG-Nr.</th>
            <th>Status</th>
            <th>Preis</th>
          </tr>
        </thead>
        <tbody>
          <% @client.processes.sort{|a, b| a.created_at <=> b.created_at }.each do |process| %>
            <tr>
              <td class="decimal"><%=h process.process_no %></td>
              <td class="workflow <%= process.workflow_state %>"><%= process.workflow_state %></td>
              <td class="money"><%=m process.gross_total_price %></td>
              <td><%= link_to image_tag('icons_16/goto.png'), process %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% end %>
  </div>
</div>

<hr />

<p class="bottom-actions">
  <% if may_edit_client?(@client) %>
    <%= link_to 'Bearbeiten', edit_client_path(@client), :class => 'edit' %>
  <% end %>
  <%= link_to 'Zurück zur Übersicht', clients_path, :class => 'back' %>
</p>

<hr />

<p class="bottom-actions">
  <%= link_to 'neuer Vermietvorgang für Kunden',  new_rental_path(:rental => {:client_id => @client.id}), :class => 'new' %>
  <%= link_to 'neuer Verkaufsvorgang für Kunden', new_selling_path(:selling => {:client_id => @client.id}), :class => 'new' %>
</p>

<p class="alternative_formats">
  Alternative Formate:
  <%= link_to image_tag('icons_16/text-xml.png') + ' XML', :format => 'xml' %> |
  <%= link_to image_tag('icons_16/application-json.png') + ' JSON', :format => 'json' %> |
</p>

<% javascript_on_load do %><script>
$('client_remarks').observe('focus', function(event) {
  event.element().removeClassName('saved');
});

$('client_remarks').observe('change', function(event) {
  event.element().up('form').request({
    onSuccess: function(response) {
      $('client_remarks').addClassName('saved');
    }
  });
});
<% end %>
