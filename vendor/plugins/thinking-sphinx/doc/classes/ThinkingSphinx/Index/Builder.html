<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: ThinkingSphinx::Index::Builder</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">ThinkingSphinx::Index::Builder</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../../files/lib/thinking_sphinx/index/builder_rb.html">
                lib/thinking_sphinx/index/builder.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                Object
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
The <a href="Builder.html">Builder</a> class is the core for the index
definition block processing. There are four methods you really need to pay
attention to:
</p>
<ul>
<li><a href="Builder.html#M000310">indexes</a>

</li>
<li><a href="Builder.html#M000311">has</a>

</li>
<li><a href="Builder.html#M000313">where</a>

</li>
<li>set_property/set_properties

</li>
</ul>
<p>
The first two of these methods allow you to define what data makes up your
<a href="Builder.html#M000310">indexes</a>. <a
href="Builder.html#M000313">where</a> provides a method to add manual SQL
conditions, and <a href="Builder.html#M000315">set_property</a> allows you
to set some settings on a per-index basis. Check out each method&#8216;s
documentation for better ideas of usage.
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000318">assoc</a>&nbsp;&nbsp;
      <a href="#M000309">define_source</a>&nbsp;&nbsp;
      <a href="#M000312">facet</a>&nbsp;&nbsp;
      <a href="#M000307">generate</a>&nbsp;&nbsp;
      <a href="#M000314">group_by</a>&nbsp;&nbsp;
      <a href="#M000311">has</a>&nbsp;&nbsp;
      <a href="#M000310">indexes</a>&nbsp;&nbsp;
      <a href="#M000317">method_missing</a>&nbsp;&nbsp;
      <a href="#M000308">new</a>&nbsp;&nbsp;
      <a href="#M000316">set_properties</a>&nbsp;&nbsp;
      <a href="#M000315">set_property</a>&nbsp;&nbsp;
      <a href="#M000313">where</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000307" class="method-detail">
        <a name="M000307"></a>

        <div class="method-heading">
          <a href="Builder.src/M000307.html" target="Code" class="method-signature"
            onclick="popupCode('Builder.src/M000307.html');return false;">
          <span class="method-name">generate</span><span class="method-args">(model, name = nil, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
        </div>
      </div>

      <div id="method-M000308" class="method-detail">
        <a name="M000308"></a>

        <div class="method-heading">
          <a href="Builder.src/M000308.html" target="Code" class="method-signature"
            onclick="popupCode('Builder.src/M000308.html');return false;">
          <span class="method-name">new</span><span class="method-args">(index, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000318" class="method-detail">
        <a name="M000318"></a>

        <div class="method-heading">
          <a href="Builder.src/M000318.html" target="Code" class="method-signature"
            onclick="popupCode('Builder.src/M000318.html');return false;">
          <span class="method-name">assoc</span><span class="method-args">(assoc, *args)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
A method to allow adding fields from associations which have names that
clash with method names in the <a href="Builder.html">Builder</a> class
(ie: properties, fields, attributes).
</p>
<p>
Example: <a href="Builder.html#M000310">indexes</a> <a
href="Builder.html#M000318">assoc</a>(:properties).column
</p>
        </div>
      </div>

      <div id="method-M000309" class="method-detail">
        <a name="M000309"></a>

        <div class="method-heading">
          <a href="Builder.src/M000309.html" target="Code" class="method-signature"
            onclick="popupCode('Builder.src/M000309.html');return false;">
          <span class="method-name">define_source</span><span class="method-args">(&amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
        </div>
      </div>

      <div id="method-M000312" class="method-detail">
        <a name="M000312"></a>

        <div class="method-heading">
          <a href="Builder.src/M000312.html" target="Code" class="method-signature"
            onclick="popupCode('Builder.src/M000312.html');return false;">
          <span class="method-name">facet</span><span class="method-args">(*args)</span>
          </a>
        </div>
      
        <div class="method-description">
        </div>
      </div>

      <div id="method-M000314" class="method-detail">
        <a name="M000314"></a>

        <div class="method-heading">
          <a href="Builder.src/M000314.html" target="Code" class="method-signature"
            onclick="popupCode('Builder.src/M000314.html');return false;">
          <span class="method-name">group_by</span><span class="method-args">(*args)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Use this method to add some manual SQL strings to the GROUP BY clause. You
can pass in as many strings as you&#8216;d like, they&#8216;ll get joined
together with commas later on.
</p>
<pre>
  group_by &quot;lat&quot;, &quot;lng&quot;
</pre>
        </div>
      </div>

      <div id="method-M000311" class="method-detail">
        <a name="M000311"></a>

        <div class="method-heading">
          <a href="Builder.src/M000311.html" target="Code" class="method-signature"
            onclick="popupCode('Builder.src/M000311.html');return false;">
          <span class="method-name">has</span><span class="method-args">(*args)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This is the method to add attributes to your index (hence why it is aliased
as &#8216;attribute&#8217;). The syntax is the same as <a
href="Builder.html#M000310">indexes</a>, so use that as starting point, but
keep in mind the following points.
</p>
<p>
An attribute can have an alias (the :as option), but it is always sortable
- so you don&#8216;t need to explicitly request that. You <em>can</em>
specify the data type of the attribute (the :type option), but the
code&#8216;s pretty good at figuring that out itself from peering into the
database.
</p>
<p>
Attributes are limited to the following types: integers, floats, datetimes
(converted to timestamps), booleans, strings and MVAs (:multi). Don&#8216;t
forget that Sphinx converts string attributes to integers, which are useful
for sorting, but that&#8216;s about it.
</p>
<p>
Collection of integers are known as multi-value attributes (MVAs).
Generally these would be through a has_many relationship, like in this
example:
</p>
<pre>
  has posts(:id), :as =&gt; :post_ids
</pre>
<p>
This allows you to filter on any of the values tied to a specific record.
Might be best to read through the Sphinx documentation to get a better idea
of that though.
</p>
<p>
Adding SQL Fragment Attributes
</p>
<p>
You can also define an attribute using an SQL fragment, useful for when you
would like to index a calculated value. Don&#8216;t forget to set the type
of the attribute though:
</p>
<pre>
  has &quot;age &lt; 18&quot;, :as =&gt; :minor, :type =&gt; :boolean
</pre>
<p>
If you&#8216;re creating attributes for latitude and longitude, don&#8216;t
forget that Sphinx expects these values to be in radians.
</p>
        </div>
      </div>

      <div id="method-M000310" class="method-detail">
        <a name="M000310"></a>

        <div class="method-heading">
          <a href="Builder.src/M000310.html" target="Code" class="method-signature"
            onclick="popupCode('Builder.src/M000310.html');return false;">
          <span class="method-name">indexes</span><span class="method-args">(*args)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This is how you add fields - the strings Sphinx looks at - to your index.
Technically, to use this method, you need to pass in some columns and
options - but there&#8216;s some neat <a
href="Builder.html#M000317">method_missing</a> stuff happening, so lets
stick to the expected syntax within a define_index block.
</p>
<p>
Expected options are :as, which points to a column alias in symbol form,
and :sortable, which indicates whether you want to sort by this field.
</p>
<p>
Adding Single-Column Fields:
</p>
<p>
You can use symbols or methods - and can chain methods together to get
access down the associations tree.
</p>
<pre>
  indexes :id, :as =&gt; :my_id
  indexes :name, :sortable =&gt; true
  indexes first_name, last_name, :sortable =&gt; true
  indexes users.posts.content, :as =&gt; :post_content
  indexes users(:id), :as =&gt; :user_ids
</pre>
<p>
Keep in mind that if any keywords for Ruby methods - such as id or name -
clash with your column names, you need to use the symbol version (see the
first, second and last examples above).
</p>
<p>
If you specify multiple columns (example 2), a field will be created for
each. Don&#8216;t use the :as option in this case. If you want to merge
those columns together, continue reading.
</p>
<p>
Adding Multi-Column Fields:
</p>
<pre>
  indexes [first_name, last_name], :as =&gt; :name
  indexes [location, parent.location], :as =&gt; :location
</pre>
<p>
To combine multiple columns into a single field, you need to wrap them in
an Array, as shown by the above examples. There&#8216;s no limitations on
whether they&#8216;re symbols or methods or what level of associations they
come from.
</p>
<p>
Adding SQL Fragment Fields
</p>
<p>
You can also define a field using an SQL fragment, useful for when you
would like to index a calculated value.
</p>
<pre>
  indexes &quot;age &lt; 18&quot;, :as =&gt; :minor
</pre>
        </div>
      </div>

      <div id="method-M000317" class="method-detail">
        <a name="M000317"></a>

        <div class="method-heading">
          <a href="Builder.src/M000317.html" target="Code" class="method-signature"
            onclick="popupCode('Builder.src/M000317.html');return false;">
          <span class="method-name">method_missing</span><span class="method-args">(method, *args)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Handles the generation of <a href="Builder.html#M000308">new</a> columns
for the field and attribute definitions.
</p>
        </div>
      </div>

      <div id="method-M000316" class="method-detail">
        <a name="M000316"></a>

        <div class="method-heading">
          <span class="method-name">set_properties</span><span class="method-args">(*args)</span>
        </div>
      
        <div class="method-description">
          <p>
Alias for <a href="Builder.html#M000315">set_property</a>
</p>
        </div>
      </div>

      <div id="method-M000315" class="method-detail">
        <a name="M000315"></a>

        <div class="method-heading">
          <a href="Builder.src/M000315.html" target="Code" class="method-signature"
            onclick="popupCode('Builder.src/M000315.html');return false;">
          <span class="method-name">set_property</span><span class="method-args">(*args)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This is what to use to set properties on the index. Chief amongst those is
the delta property - to allow automatic updates to your <a
href="Builder.html#M000310">indexes</a> as <a
href="Builder.html#M000308">new</a> models are added and edited - but also
you can define search-related properties which will be the defaults for all
searches on the model.
</p>
<pre>
  set_property :delta =&gt; true
  set_property :field_weights =&gt; {&quot;name&quot; =&gt; 100}
  set_property :order =&gt; &quot;name ASC&quot;
  set_property :select =&gt; 'name'
</pre>
<p>
Also, the following two properties are particularly relevant for
geo-location searching - latitude_attr and longitude_attr. If your
attributes for these two values are named something other than lat/latitude
or lon/long/longitude, you can dictate what they are when defining the
index, so you don&#8216;t need to specify them for every geo-related
search.
</p>
<pre>
  set_property :latitude_attr =&gt; &quot;lt&quot;, :longitude_attr =&gt; &quot;lg&quot;
</pre>
<p>
Please don&#8216;t forget to add a boolean field named &#8216;delta&#8217;
to your model&#8216;s database table if enabling the delta index for it.
Valid options for the delta property are:
</p>
<p>
true false :default :delayed :datetime
</p>
<p>
You can also extend <a
href="../Deltas/DefaultDelta.html">ThinkingSphinx::Deltas::DefaultDelta</a>
to implement your own handling for delta indexing.
</p>
        </div>
      </div>

      <div id="method-M000313" class="method-detail">
        <a name="M000313"></a>

        <div class="method-heading">
          <a href="Builder.src/M000313.html" target="Code" class="method-signature"
            onclick="popupCode('Builder.src/M000313.html');return false;">
          <span class="method-name">where</span><span class="method-args">(*args)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Use this method to add some manual SQL conditions for your index request.
You can pass in as many strings as you like, they&#8216;ll get joined
together with ANDs later on.
</p>
<pre>
  where &quot;user_id = 10&quot;
  where &quot;parent_type = 'Article'&quot;, &quot;created_at &lt; NOW()&quot;
</pre>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>